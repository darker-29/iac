AWSTemplateFormatVersion: "2010-09-09"
Description: Template generated by rain

Resources:
  ApplicationLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub ${Env}-ApplicationLog
      RetentionInDays: 30
 
  ApplicationErrorSubscriptionFilter:
    Type: AWS::Logs::SubscriptionFilter
    Properties:
      FilterPattern: error
      LogGroupName: !GetAtt ApplicationLogGroup.Arn
      DestinationArn: !GetAtt ApplicationErrorAlertFunction

  ApplicationErrorAlertTopic:
    Type: AWS::SNS::Topic
    Properties:
      TopicName: ApplicationErrorAlert
      Subscription:
        - Endpoint: darker-29.developer@gmail.com
          Protocol: email
      Tags:
        - Key: Name
          Value: ApplicationErrorAlert

  ApplicationErrorAlertFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: SendDetailLogs
      Description: CHANGEME # Optional
      Runtime: Python3.9
      Handler: index
      Code:
        ZipFile:
      Environment: # Optional
        Variables: # Optional
          CHANGEME: CHANGEME
      MemorySize: 128
      Timeout: 3
      Role: CHANGEME
      Tags:
        - Key: CHANGEME
          Value: CHANGEME

  CWLogsInvokeLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      Principal: logs.amazonaws.com
      Action: lambda:InvokeFunction
      FunctionName: !GetAtt ApplicationErrorAlertFunction
      SourceArn: !GetAtt ApplicationErrorAlertTopic.Arn
